"use strict";(self.webpackChunkrotorflight_docs=self.webpackChunkrotorflight_docs||[]).push([[3049],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var u=n.createContext({}),l=function(e){var t=n.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},c=function(e){var t=l(e.components);return n.createElement(u.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(r),m=o,f=p["".concat(u,".").concat(m)]||p[m]||h[m]||i;return r?n.createElement(f,a(a({ref:t},c),{},{components:r})):n.createElement(f,a({ref:t},c))}));function f(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,a=new Array(i);a[0]=m;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[p]="string"==typeof e?e:o,a[1]=s;for(var l=2;l<i;l++)a[l]=r[l];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}m.displayName="MDXCreateElement"},8876:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var n=r(7462),o=(r(7294),r(3905));const i={sidebar_position:85},a="RPM Measurement",s={unversionedId:"Tutorial - Setup/Frequency",id:"Tutorial - Setup/Frequency",title:"RPM Measurement",description:"In order to use the Governor or RPM filters (and why wouldnt you!!) you must measure the RPM. There are two options for this",source:"@site/docs/Tutorial - Setup/Frequency.md",sourceDirName:"Tutorial - Setup",slug:"/Tutorial - Setup/Frequency",permalink:"/docs/Tutorial - Setup/Frequency",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Tutorial - Setup/Frequency.md",tags:[],version:"current",sidebarPosition:85,frontMatter:{sidebar_position:85},sidebar:"tutorialSidebar",previous:{title:"Motor and ESC",permalink:"/docs/Tutorial - Setup/Motor and ESC"},next:{title:"Governor",permalink:"/docs/Tutorial - Setup/Governor"}},u={},l=[{value:"Frequency Sensor",id:"frequency-sensor",level:2},{value:"Configuration",id:"configuration",level:2},{value:"The lines which configure the frequency signal",id:"the-lines-which-configure-the-frequency-signal",level:3}],c={toc:l},p="wrapper";function h(e){let{components:t,...r}=e;return(0,o.kt)(p,(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"rpm-measurement"},"RPM Measurement"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"In order to use the Governor or RPM filters (and why wouldnt you!!) you must measure the RPM. There are two options for this  "),(0,o.kt)("ol",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ol"},"Frequency input feature -   "),(0,o.kt)("li",{parentName:"ol"},"Bi-Directional Dshot - ")),(0,o.kt)("h2",{parentName:"admonition",id:"note"},"Note"),(0,o.kt)("p",{parentName:"admonition"},"RPM can also be read via ESC telemetry; however, this is at a refresh frequency that is generally too slow to be used   ")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"RPM filtering is used to remove frequencies related to the rotating components. This allows a much higher tune; HOWEVER!! If the helicopter is flown in an overspeed condition the rotation of the one way bearing means that the RPM measurement will not be correct. If the helicopter is tuned to critically this could mean  ")),(0,o.kt)("h2",{id:"frequency-sensor"},"Frequency Sensor"),(0,o.kt)("p",null,"Typically it is used when the RPM is not available via ESC telemetry. Only BLHeli_32, some BLHeli_S and APD F3 ESCs support Dshot/KISS telemetry, so this feature is needed with a wide range of traditional ESCs."),(0,o.kt)("p",null,"The RPM signal is used in multiple places in the FC, e.g. in the PID control, the governor and the RPM-filter. If these features are not needed, then there is no need for the frequency sensor either."),(0,o.kt)("p",null,"An electrical frequency signal is provided by some ESCs, e.g. Hobbywing with the \"yellow\" wire. Or it can come from an RPM sensor, which is converting the motor three-phase voltages into a frequency signal - e.g. Hobbywing RPM sensor. Please refer to your ESC's or sensor's manuals how to connect them correctly."),(0,o.kt)("p",null,"Note about the Hobbywing RPM sensor: it's safest to power it with 3.3V, as the input voltage of the sensor is also the output voltage of the RPM signal it generates. All inputs on a STM32 MCU tolerate 3.3V, and some will also accept 5V. But if you're using a 8.4V BEC to power the sensor, you'll likely damage the MCU."),(0,o.kt)("p",null,"Up to two frequency sensors are supported, for acquiring motor #1 and motor #2 speed."),(0,o.kt)("p",null,"If both Frequency Sensor and telemetry RPM signals are available, the Frequency Sensor has precedence."),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("p",null,"First, a pin must be configured for frequency sensor use. The pin ",(0,o.kt)("em",{parentName:"p"},"must")," be connected to a timer with exclusive access.\nIn other words, there must be a free timer, not used by anything else, and one of its positive channels must be available\non a pin that is connected to the FC's solder pads. Negative channels, like CH3N, can't be used as inputs. Once we know which timer and pin we can use, it can be configured for\nfrequency sensor use. This can be done via the ",(0,o.kt)("a",{parentName:"p",href:"./Remapping"},"Custom defaults remapping spreadsheet")," or by reading through the STM32 manual for your processor."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"We recomend that Freq inputs are alocated to pins that have Timer 2 or Timer 5 available. If 2 Freq inputs are required (e.g. Motorised tail) then both inputs can share the same timer. In the remapping spreadsheet these pins are indicated by the green box marked Freq. ")),(0,o.kt)("p",null,"In this example, we have chosen to use the LED_STRIP pin as our frequency input. We see there is only one option (Timer1) on AF1. We can use this pin but must not allocate any of the Servos or Motors to Timer1. Only the motor pins share this timer so we can choose either AF2 (timer3) or AF3 (timer8)."),(0,o.kt)("p",null,"[https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_1.png]"," (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_1.png"},"https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_1.png"),")"),(0,o.kt)("h3",{id:"the-lines-which-configure-the-frequency-signal"},"The lines which configure the frequency signal"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"resource LED_STRIP 1 NONE                                           \nresource Freq  1 A09                                            \ntimer A09 AF1 # Freq - pin A09: TIM1 CH2 (AF1)\ndma pin A09 0 # Freq - 0: DMA2 Stream 6 Channel 0\n")),(0,o.kt)("p",null,"Then the frequency sensor can be turned ON with the feature flag located on the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"Configuration"))," tab."),(0,o.kt)("p",null,"[",(0,o.kt)("a",{parentName:"p",href:"https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_2.png%22"},'https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_2.png"'),"\n(",(0,o.kt)("a",{parentName:"p",href:"https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_2.png"},"https://github.com/rotorflight/rotorflight/blob/master/wiki/Setup/frequency_2.png"),")"))}h.isMDXComponent=!0}}]);